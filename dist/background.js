(()=>{"use strict";var e=function(e,r,t,o){return new(t||(t=Promise))((function(n,s){function c(e){try{a(o.next(e))}catch(e){s(e)}}function i(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var r;e.done?n(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(c,i)}a((o=o.apply(e,r||[])).next())}))};const r=(r,t)=>e(void 0,void 0,void 0,(function*(){const e=yield(o="csrf_token",new Promise(((e,r)=>{chrome.storage.local.get([o],(r=>{r[o]?e(r[o]):e(null)}))})));var o;return e?yield fetch(`https://www.linkedin.com${r}`,Object.assign(Object.assign({},t),{headers:Object.assign(Object.assign({},t.headers),{"csrf-token":e})})).then((e=>{if(e.status>300)throw new Error(`error_${e.status}`);return e.json()})).catch((e=>{if(e instanceof Error){const r={message:e.message,stack:e.stack};console.error("Error occurred while calling LinkedIn API:",r)}else console.error("Error occurred while calling LinkedIn API:",JSON.stringify(e,null,2));if(e.message.startsWith("error_")){const[,r]=e.message.split("_");return{error:!0,code:Number(r)}}return null})):null})),t=t=>e(void 0,void 0,void 0,(function*(){const e=yield r("/voyager/api/me",{method:"GET"});return console.log("LinkedIn Profile Data:",e),e})),o=(t=0)=>e(void 0,void 0,void 0,(function*(){const e=yield r("/voyager/api/relationships/dash/connections?decorationId=com.linkedin.voyager.dash.deco.web.mynetwork.ConnectionListWithProfile-16&count=10&q=search&sortType=RECENTLY_ADDED&start="+10*t,{method:"GET"});return console.log("Linkedin Profile Connections",e),e})),n=()=>e(void 0,void 0,void 0,(function*(){const e=yield r("/voyager/api/search/dash/clusters?decorationId=com.linkedin.voyager.dash.deco.search.SearchClusterCollection-1&count=0&origin=Communities&q=all&query=(queryParameters:(resultType:List(CONNECTIONS)),flagshipSearchIntent:MYNETWORK_CURATION_HUB)&start=0",{method:"GET"});return console.log("Linkedin Total Connections",e),e}));chrome.runtime.onInstalled.addListener((function(e){chrome.storage.local.set({BD_Host:"http://localhost:3000"}),chrome.alarms.create("ALARAMS_ON",{periodInMinutes:1}),chrome.tabs.query({},(e=>{chrome.storage.local.get("BD_Host",(r=>{const t=r.BD_Host||"http://localhost:3000",o=e.filter((e=>e.url.includes("https://www.linkedin.com"))),n=e.filter((e=>e.url.includes(t)));if(o.length>0){const e=o[0];chrome.scripting.executeScript({target:{tabId:e.id},files:["/content_scripts/linkedin.js"]})}else chrome.tabs.create({url:"https://www.linkedin.com"});if(n.length>0){const e=n[0];chrome.scripting.executeScript({target:{tabId:e.id},files:["/content_scripts/bd.js"]})}}))})),"install"==e.reason&&(chrome.storage.local.clear(),t(),o(),n()),"update"==e.reason&&(t(),o(),n())})),chrome.alarms.onAlarm.addListener((e=>{if("ALARAMS_ON"===e.name)t(),o(),n()})),chrome.runtime.onMessageExternal.addListener(((s,c,i)=>{const{type:a,start:l,searchTerm:d}=s;switch(a){case"MESSAGE":return i({signal:!0});case"LINKEDINPROFILE":t().then((e=>{i({response:e})})).catch((e=>{i({error:"Failed to fetch LinkedIn profile data"})}));break;case"LINKEDCONNECTION":o(l).then((e=>{i({response:e})})).catch((e=>{i({error:"Failed to fetch LinkedIn Connection data"})}));break;case"LINKEDTOTALCONNECTION":n().then((e=>{i({response:e})})).catch((e=>{i({error:"Failed to fetch LinkedIn Total Connection data"})}));break;case"SEARCHPROFILE":{const{searchTerm:t}=s;(t=>e(void 0,void 0,void 0,(function*(){if(!t)throw new Error("Search term is required!");const e=encodeURIComponent(t),o=yield r(`/voyager/api/graphql?variables=(query:${e})&queryId=voyagerSearchDashTypeahead.eeea0c1dfdf533272e9de4e98a59d725`,{method:"GET"});return console.log("Specific Search Profiles",o),o})))(t).then((e=>{i({response:e})})).catch((e=>{i({error:"Failed to fetch LinkedIn Search Profile data"})}));break}case"AUTHENTICATION_LOGOUT":new Promise((e=>{chrome.storage.local.remove("AUTH_TOKEN",(()=>{e(!0)}))}))}}))})();