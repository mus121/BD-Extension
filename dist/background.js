(()=>{"use strict";var e=function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function c(e){try{a(r.next(e))}catch(e){s(e)}}function i(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,i)}a((r=r.apply(e,t||[])).next())}))};const t=(t,n)=>e(void 0,void 0,void 0,(function*(){const e=yield(r="csrf_token",new Promise(((e,t)=>{chrome.storage.local.get([r],(t=>{t[r]?e(t[r]):e(null)}))})));var r;return e?yield fetch(`https://www.linkedin.com${t}`,Object.assign(Object.assign({},n),{headers:Object.assign(Object.assign({},n.headers),{"csrf-token":e})})).then((e=>{if(e.status>300)throw new Error(`error_${e.status}`);return e.json()})).catch((e=>{if(e instanceof Error){const t={message:e.message,stack:e.stack};console.error("Error occurred while calling LinkedIn API:",t)}else console.error("Error occurred while calling LinkedIn API:",JSON.stringify(e,null,2));if(e.message.startsWith("error_")){const[,t]=e.message.split("_");return{error:!0,code:Number(t)}}return null})):null})),n=()=>e(void 0,void 0,void 0,(function*(){const e=yield t("/voyager/api/me",{method:"GET"});return console.log("LinkedIn Profile Data:",e),e})),r=()=>e(void 0,void 0,void 0,(function*(){const e=yield t("/voyager/api/relationships/dash/connections?decorationId=com.linkedin.voyager.dash.deco.web.mynetwork.ConnectionListWithProfile-16&count=8&q=search&sortType=RECENTLY_ADDED&start=0",{method:"GET"});return console.log("Linkedin Profile Connections",e),e}));chrome.runtime.onInstalled.addListener((function(e){chrome.storage.local.set({BD_Host:"http://localhost:3000"}),chrome.alarms.create("ALARAMS_ON",{periodInMinutes:1}),chrome.tabs.query({},(e=>{chrome.storage.local.get("BD_Host",(t=>{const n=t.BD_Host||"http://localhost:3000",r=e.filter((e=>e.url.includes("https://www.linkedin.com"))),o=e.filter((e=>e.url.includes(n)));if(r.length>0){const e=r[0];chrome.scripting.executeScript({target:{tabId:e.id},files:["/content_scripts/linkedin.js"]})}else chrome.tabs.create({url:"https://www.linkedin.com"});if(o.length>0){const e=o[0];chrome.scripting.executeScript({target:{tabId:e.id},files:["/content_scripts/bd.js"]})}}))})),"install"==e.reason&&(chrome.storage.local.clear(),n(),r()),"update"==e.reason&&(n(),r())})),chrome.alarms.onAlarm.addListener((e=>{"ALARAMS_ON"===e.name&&(n(),r())})),chrome.runtime.onMessageExternal.addListener(((e,t,o)=>{const{type:s}=e;switch(s){case"MESSAGE":return o({signal:!0});case"LINKEDINPROFILE":n().then((e=>{o({response:e})})).catch((e=>{o({error:"Failed to fetch LinkedIn profile data"})}));case"LINKEDCONNECTION":r().then((e=>{o({response:e})})).catch((e=>{o({error:"Failed to fetch LinkedIn profile data"})}));case"AUTHENTICATION_LOGOUT":new Promise((e=>{chrome.storage.local.remove("AUTH_TOKEN",(()=>{e(!0)}))}))}}))})();