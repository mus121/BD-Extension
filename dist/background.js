(()=>{"use strict";const e="MISSING_ENV_VAR".BD_HOST||"http://localhost:3000",n="https://www.linkedin.com";var t;!function(e){e.MESSAGE="MESSAGE",e.LI_PROFILE="LINKEDIN_PROFILE",e.LI_CONNECTION="LINKED_CONNECTION",e.LI_TOTAL_CONNECTION="LINKED_TOTAL_CONNECTION",e.LI_GLOBAL_DROPDOWN="SEARCH_PROFILE",e.LI_LOCATION="LOCATION",e.LI_GLOBAL_PROFILES="GLOBAL_SEARCH_PROFILE"}(t||(t={}));const i=(e,n)=>{return t=void 0,i=void 0,r=function*(){const t=yield(i="csrf_token",new Promise(((e,n)=>{chrome.storage.local.get([i],(n=>{n[i]?e(n[i]):e(null)}))})));var i;return t?yield fetch(`https://www.linkedin.com${e}`,Object.assign(Object.assign({},n),{headers:Object.assign(Object.assign({},n.headers),{"csrf-token":t})})).then((e=>{if(e.status>300)throw new Error(`error_${e.status}`);return e.json()})).catch((e=>{if(e instanceof Error){const n={message:e.message,stack:e.stack};console.error("Error occurred while calling LinkedIn API:",n)}else console.error("Error occurred while calling LinkedIn API:",JSON.stringify(e,null,2));if(e.message.startsWith("error_")){const[,n]=e.message.split("_");return{error:!0,code:Number(n)}}return null})):null},new((o=void 0)||(o=Promise))((function(e,n){function l(e){try{c(r.next(e))}catch(e){n(e)}}function a(e){try{c(r.throw(e))}catch(e){n(e)}}function c(n){var t;n.done?e(n.value):(t=n.value,t instanceof o?t:new o((function(e){e(t)}))).then(l,a)}c((r=r.apply(t,i||[])).next())}));var t,i,o,r};chrome.runtime.onInstalled.addListener((function(){chrome.tabs.query({},(t=>{const i=t.filter((e=>e.url.includes(n))),o=t.filter((n=>n.url.includes(e)));if(i.length>0){const e=i[0];chrome.scripting.executeScript({target:{tabId:e.id},files:["/content_scripts/linkedin.js"]})}else chrome.tabs.create({url:n});if(o.length>0){const e=o[0];chrome.scripting.executeScript({target:{tabId:e.id},files:["/content_scripts/bd.js"]})}}))})),chrome.runtime.onMessageExternal.addListener(((e,n,o)=>{const{type:r,start:l,searchTerm:a,publicIdentifier:c,page:d}=e;switch(r){case t.MESSAGE:o({signal:!0});break;case t.LI_PROFILE:(s=void 0,u=void 0,v=void 0,f=function*(){const e=yield i("/voyager/api/me",{method:"GET"});if("error"in e)throw new Error(`API Error: ${e.message||"Unknown error"} (Code: ${e.code})`);return e},new(v||(v=Promise))((function(e,n){function t(e){try{o(f.next(e))}catch(e){n(e)}}function i(e){try{o(f.throw(e))}catch(e){n(e)}}function o(n){var o;n.done?e(n.value):(o=n.value,o instanceof v?o:new v((function(e){e(o)}))).then(t,i)}o((f=f.apply(s,u||[])).next())}))).then((e=>{o({response:e})})).catch((e=>{o({error:"Failed to fetch LinkedIn profile data"})}));break;case t.LI_CONNECTION:((e=0)=>function(e,n,t,i){return new(t||(t=Promise))((function(o,r){function l(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(l,a)}c((i=i.apply(e,n||[])).next())}))}(void 0,void 0,void 0,(function*(){const n=yield i("/voyager/api/relationships/dash/connections?decorationId=com.linkedin.voyager.dash.deco.web.mynetwork.ConnectionListWithProfile-16&count=10&q=search&sortType=RECENTLY_ADDED&start="+10*e,{method:"GET"});if("error"in n)throw new Error(`API Error: ${n.message||"Unknown error"} (Code: ${n.code})`);return(n.elements||[]).map((e=>{var n,t,i,o,r,l,a,c,d,s,u,v,f,h;const m=(null===(n=e.connectedMemberResolutionResult)||void 0===n?void 0:n.firstName)||"N/A",y=(null===(t=e.connectedMemberResolutionResult)||void 0===t?void 0:t.lastName)||"N/A",I=(null===(i=e.connectedMemberResolutionResult)||void 0===i?void 0:i.headline)||"N/A",p=(null===(o=e.connectedMemberResolutionResult)||void 0===o?void 0:o.entityUrn)||"N/A",g=(null===(r=e.connectedMemberResolutionResult)||void 0===r?void 0:r.publicIdentifier)||"N/A",N=null===(s=null===(d=null===(c=null===(a=null===(l=e.connectedMemberResolutionResult)||void 0===l?void 0:l.profilePicture)||void 0===a?void 0:a.displayImageReference)||void 0===c?void 0:c.vectorImage)||void 0===d?void 0:d.artifacts)||void 0===s?void 0:s[0];return{firstName:m,lastName:y,completeImageUrl:N?(null===(h=null===(f=null===(v=null===(u=e.connectedMemberResolutionResult)||void 0===u?void 0:u.profilePicture)||void 0===v?void 0:v.displayImageReference)||void 0===f?void 0:f.vectorImage)||void 0===h?void 0:h.rootUrl)+N.fileIdentifyingUrlPathSegment:"/assets/images/LiDefault.png",headLine:I,entityUrn:p,publicIdentifier:g}})).filter((e=>"N/A"!==e.firstName&&"N/A"!==e.lastName&&"N/A"!==e.headLine))})))(l).then((e=>{o({response:e})})).catch((e=>{o({error:"Failed to fetch LinkedIn Connection data"})}));break;case t.LI_TOTAL_CONNECTION:(function(e,n,t,i){return new(t||(t=Promise))((function(o,r){function l(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(l,a)}c((i=i.apply(e,n||[])).next())}))})(void 0,void 0,void 0,(function*(){var e;const n=yield i("/voyager/api/search/dash/clusters?decorationId=com.linkedin.voyager.dash.deco.search.SearchClusterCollection-1&count=0&origin=Communities&q=all&query=(queryParameters:(resultType:List(CONNECTIONS)),flagshipSearchIntent:MYNETWORK_CURATION_HUB)&start=0",{method:"GET"});if("error"in n)throw new Error(`API Error: ${n.message||"Unknown error"} (Code: ${n.code})`);return null===(e=null==n?void 0:n.metadata)||void 0===e?void 0:e.totalResultCount})).then((e=>{o({response:e})})).catch((e=>{o({error:"Failed to fetch LinkedIn Total Connection data"})}));break;case t.LI_GLOBAL_DROPDOWN:{const{searchTerm:n}=e;(e=>function(e,n,t,i){return new(t||(t=Promise))((function(o,r){function l(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(l,a)}c((i=i.apply(e,n||[])).next())}))}(void 0,void 0,void 0,(function*(){var n,t;if(!e)throw new Error("Search term is required!");const o=encodeURIComponent(e),r=yield i(`/voyager/api/graphql?variables=(start:0,origin:GLOBAL_SEARCH_HEADER,query:(keywords:${o},flagshipSearchIntent:SEARCH_SRP,queryParameters:List((key:resultType,value:List(PEOPLE))),includeFiltersInResponse:false))&queryId=voyagerSearchDashClusters.cd5ee9d14d375bf9ca0596cfe0cbb926`,{method:"GET"});if("error"in r)throw new Error(`API Error: ${r.message||"Unknown error"} (Code: ${r.code})`);const l=((null===(t=null===(n=null==r?void 0:r.data)||void 0===n?void 0:n.searchDashClustersByAll)||void 0===t?void 0:t.elements)||[]).flatMap((e=>((null==e?void 0:e.items)||[]).map((e=>{var n,t,i,o,r,l,a,c,d,s,u;const v=null===(n=null==e?void 0:e.item)||void 0===n?void 0:n.entityResult;let f="";const h=(null==v?void 0:v.navigationUrl)||"N/A";if(h.includes("linkedin.com/in/")){const e=h.split("linkedin.com/in/");e.length>1&&(f=e[1].split(/[?#]/)[0])}const m=(null===(d=null===(c=null===(a=null===(l=null===(r=null===(o=null===(i=null===(t=null==v?void 0:v.image)||void 0===t?void 0:t.attributes)||void 0===i?void 0:i[0])||void 0===o?void 0:o.detailData)||void 0===r?void 0:r.nonEntityProfilePicture)||void 0===l?void 0:l.vectorImage)||void 0===a?void 0:a.artifacts)||void 0===c?void 0:c[0])||void 0===d?void 0:d.fileIdentifyingUrlPathSegment)||"/assets/images/Avatar.png",y=m.startsWith("http")?m:`https://media.licdn.com/${m}`;return{title:(null===(s=null==v?void 0:v.title)||void 0===s?void 0:s.text)||"N/A",subtitle:(null===(u=null==v?void 0:v.primarySubtitle)||void 0===u?void 0:u.text)||"N/A",image:y,entityUrn:(null==v?void 0:v.entityUrn)||"N/A",publicIdentifier:f}}))));return l.filter((e=>"N/A"!==e.title&&"N/A"!==e.subtitle&&"/assets/images/Avatar.png"!==e.image&&"N/A"!==e.entityUrn&&""!==e.publicIdentifier))})))(n).then((e=>{o({response:e})})).catch((e=>{o({error:"Failed to fetch LinkedIn Dropdown Profile data"})}));break}case t.LI_LOCATION:(e=>function(e,n,t,i){return new(t||(t=Promise))((function(o,r){function l(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(l,a)}c((i=i.apply(e,n||[])).next())}))}(void 0,void 0,void 0,(function*(){var n,t,o,r,l;const a=yield i(`/voyager/api/graphql?includeWebMetadata=true&variables=(vanityName:${encodeURIComponent(e)})&queryId=voyagerIdentityDashProfiles.545b6b61da02e06975ba277b722ad219`,{method:"GET"});return(null===(l=null===(r=null===(o=null===(t=null===(n=null==a?void 0:a.data.identityDashProfilesByMemberIdentity)||void 0===n?void 0:n.elements)||void 0===t?void 0:t[0])||void 0===o?void 0:o.geoLocation)||void 0===r?void 0:r.geo)||void 0===l?void 0:l.defaultLocalizedName)||""})))(c).then((e=>{o({response:e})})).catch((e=>{o({error:"Failed to fetch LinkedIn Location data"})}));break;case t.LI_GLOBAL_PROFILES:((e,n=0)=>function(e,n,t,i){return new(t||(t=Promise))((function(o,r){function l(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(l,a)}c((i=i.apply(e,n||[])).next())}))}(void 0,void 0,void 0,(function*(){var t,o;const r=10*n,l=yield i(`/voyager/api/graphql?variables=(start:${r},origin:GLOBAL_SEARCH_HEADER,query:(keywords:${e},flagshipSearchIntent:SEARCH_SRP,queryParameters:List((key:resultType,value:List(PEOPLE)),(key:searchId,value:List(df200630-b31a-4170-b80e-98f1f0b0ffe0))),includeFiltersInResponse:false))&queryId=voyagerSearchDashClusters.cd5ee9d14d375bf9ca0596cfe0cbb926`,{method:"GET"});if("error"in l)throw new Error(`API Error: ${l.message||"Unknown error"} (Code: ${l.code})`);const a=(null===(t=l.data.searchDashClustersByAll)||void 0===t?void 0:t.elements)||[],c=(null===(o=l.data.searchDashClustersByAll)||void 0===o?void 0:o.paging)||[],d=a.flatMap((e=>(e.items||[]).map((e=>{var n,t,i,o,r,l,a,d,s,u,v;const f=e.item.entityResult;return{name:(null===(n=null==f?void 0:f.image)||void 0===n?void 0:n.accessibilityText)||"N/A",imageUrl:(null===(s=null===(d=null===(a=null===(l=null===(r=null===(o=null===(i=null===(t=null==f?void 0:f.image)||void 0===t?void 0:t.attributes)||void 0===i?void 0:i[0])||void 0===o?void 0:o.detailData)||void 0===r?void 0:r.nonEntityProfilePicture)||void 0===l?void 0:l.vectorImage)||void 0===a?void 0:a.artifacts)||void 0===d?void 0:d[0])||void 0===s?void 0:s.fileIdentifyingUrlPathSegment)||"N/A",location:(null===(u=null==f?void 0:f.secondarySubtitle)||void 0===u?void 0:u.text)||"N/A",headline:(null===(v=null==f?void 0:f.primarySubtitle)||void 0===v?void 0:v.text)||"N/A",totalcount:c||"N/A",public_Identifier:null==f?void 0:f.navigationUrl,entityUrn:null==f?void 0:f.entityUrn}}))));return d.filter((e=>"N/A"!==e.name&&"N/A"!==e.imageUrl&&"N/A"!==e.location&&"N/A"!==e.headline&&"N/A"!==e.totalcount&&"N/A"!==e.public_Identifier&&"N/A"!==e.entityUrn))})))(a,d).then((e=>{o({response:e})})).catch((e=>{o({error:"Failed to fetch LinkedIn Global Search Profile data"})}));break;case"AUTHENTICATION_LOGOUT":new Promise((e=>{chrome.storage.local.remove("AUTH_TOKEN",(()=>{e(!0)}))}))}var s,u,v,f}))})();