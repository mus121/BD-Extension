(()=>{"use strict";var e;!function(e){e.FETCH_PROFILE="FETCH_PROFILE",e.FETCH_CONNECTIONS="FETCH_CONNECTIONS",e.FETCH_SEARCH="FETCH_SEARCH",e.SEARCH_PROFILES="SEARCH_PROFILES",e.ERROR="ERROR"}(e||(e={}));const n="https://www.linkedin.com",t="/voyager/api/me",o="/voyager/api/relationships/dash/connections",r="/voyager/api/graphql";var i=function(e,n,t,o){return new(t||(t=Promise))((function(r,i){function a(e){try{s(o.next(e))}catch(e){i(e)}}function c(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,c)}s((o=o.apply(e,n||[])).next())}))};const a={get(e){return i(this,void 0,void 0,(function*(){return new Promise((n=>{chrome.storage.local.get([e],(t=>{n(t[e]||null)}))}))}))},set(e,n){return i(this,void 0,void 0,(function*(){return chrome.storage.local.set({[e]:n})}))},remove(e){return i(this,void 0,void 0,(function*(){return chrome.storage.local.remove(e)}))}};var c=function(e,n,t,o){return new(t||(t=Promise))((function(r,i){function a(e){try{s(o.next(e))}catch(e){i(e)}}function c(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,c)}s((o=o.apply(e,n||[])).next())}))};class s{static makeRequest(e){return c(this,arguments,void 0,(function*(e,t={}){try{const o=yield a.get("csrf_token");if(!o)throw new Error("CSRF token not found");const r=yield fetch(`${n}${e}`,Object.assign(Object.assign({},t),{headers:Object.assign(Object.assign({},t.headers),{"csrf-token":o})}));if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return{data:yield r.json()}}catch(e){return{error:{code:500,message:e instanceof Error?e.message:"Unknown error occurred"}}}}))}static getProfile(){return c(this,void 0,void 0,(function*(){return this.makeRequest(t)}))}static getConnections(){return c(this,arguments,void 0,(function*(e=0,n=10){return this.makeRequest(`${o}?decorationId=com.linkedin.voyager.dash.deco.web.mynetwork.ConnectionListWithProfile-16&q=search&start=${e}&count=${n}&sortType=RECENTLY_ADDED`)}))}static searchProfiles(e){return c(this,void 0,void 0,(function*(){const n=encodeURIComponent(e);return this.makeRequest(`${r}?variables=(query:${n})&queryId=voyagerSearchDashTypeahead.eeea0c1dfdf533272e9de4e98a59d725`)}))}}const u=()=>{chrome.cookies.getAll({url:n},(e=>{const n=e.find((e=>"JSESSIONID"===e.name));n&&a.set("csrf_token",n.value.replace(/['"]+/g,""))}))};chrome.runtime.onInstalled.addListener((()=>{u()})),chrome.cookies.onChanged.addListener((e=>{var n;"JSESSIONID"===e.cookie.name&&!1===e.removed&&(null===(n=e.cookie.domain)||void 0===n?void 0:n.includes("linkedin.com"))&&u()})),chrome.runtime.onMessageExternal.addListener(((n,t,o)=>(((n,t)=>{var o,r,i,a;o=void 0,r=void 0,a=function*(){switch(n.type){case e.FETCH_PROFILE:const o=yield s.getProfile();t(o);break;case e.FETCH_CONNECTIONS:const r=yield s.getConnections(n.payload.start,n.payload.count);t(r);break;case e.SEARCH_PROFILES:const i=yield s.searchProfiles(n.payload);t(i);break;default:t({error:{code:400,message:"Unknown message type"}})}},new((i=void 0)||(i=Promise))((function(e,n){function t(e){try{s(a.next(e))}catch(e){n(e)}}function c(e){try{s(a.throw(e))}catch(e){n(e)}}function s(n){var o;n.done?e(n.value):(o=n.value,o instanceof i?o:new i((function(e){e(o)}))).then(t,c)}s((a=a.apply(o,r||[])).next())}))})({type:n,payload:t},o),!0)))})();